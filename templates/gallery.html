{% extends "base.html" %}
{% block content %}
  <a href="/">← Back</a>
  <h2>{{ gallery.title }}</h2>
  <p class="muted">{{ gallery.date }}</p>

  {% if gallery.images and gallery.images[0].webp_url %}
    <div class="gallery-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px">
      {% for img in gallery.images %}
        {# each thumb opens its overlay #}
        <a href="#{{ gallery.slug }}-{{ loop.index0 }}" data-caption="{{ img.alt | e }}">
          <img loading="lazy" decoding="async" src="{{ img.thumb_url }}" alt="{{ img.alt }}" style="width:100%;height:auto">
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p>No images yet.</p>
  {% endif %}

  {# Lightbox overlays (one per image) #}
  {% if gallery.images|length %}
    {% set count = gallery.images|length %}
    {% for img in gallery.images %}
      {% set prev = loop.index0 - 1 if loop.index0 > 0 else count - 1 %}
      {% set nxt  = loop.index0 + 1 if loop.index0 + 1 < count else 0 %}
      <div class="lb-backdrop" id="{{ gallery.slug }}-{{ loop.index0 }}" aria-modal="true" role="dialog" aria-label="Image {{ loop.index }} of {{ count }}">
        <a class="lb-close" href="#" aria-label="Close">×</a>
        <a class="lb-prev"  href="#{{ gallery.slug }}-{{ prev }}" aria-label="Previous">‹</a>
        <div class="lb-dialog">
          <img class="lb-img" src="{{ img.webp_url }}" alt="{{ img.alt }}">
          {% if img.alt %}
            <div class="lb-caption">{{ img.alt }}</div>
          {% endif %}
        </div>
        <a class="lb-next"  href="#{{ gallery.slug }}-{{ nxt }}" aria-label="Next">›</a>
      </div>
    {% endfor %}
  {% endif %}
{% endblock %}

